{"version":3,"file":"index.test.js","sourceRoot":"","sources":["index.test.ts"],"names":[],"mappings":"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","sourcesContent":["import 'jest'\nimport {MongoQueue,MongooseConfiguration,Mongo} from '../src'\n\nconst mongoConfig:MongooseConfiguration = {\n  uris: 'mongodb://192.168.56.3:27017/partnership-test',\n  prefix: 'partnership',\n  debug: false,\n  connectionOptions: {\n    useNewUrlParser: true, // Must pass port to URI\n    useCreateIndex: true, // To turn off Mongoose warning, use createIndex() instead ensureIndex()\n    useUnifiedTopology: true, // New Mongo monitoring\n    useFindAndModify: false,\n    //poolSize: 100\n  }\n}\n\ndescribe('test mongoqueues', () =>{\n  const mongoConnection = new Mongo(mongoConfig)\n  const mongoqueue = new MongoQueue(mongoConfig)\n  const MongoQueueService = mongoqueue.getMongoQueueService()\n  afterAll(async() => await mongoConnection.disconectMongo());\n  test('register queue', async () => {\n    return await MongoQueueService.createQueue({\n      code:'queue_sync_group_price_to_omni'\n  }).then(data => {\n      console.log(data)\n      expect(data).toBeDefined()\n      \n    })\n  })\n})\n\nfunction registerMongoQueue(mongoqueue:any, queue_code:string, funcobject:any)\n{\n  const MongoQueueService = mongoqueue.getMongoQueueService()\n    MongoQueueService.Func={[queue_code]:funcobject}\n    const data = {\n        code:queue_code\n    }\n    MongoQueueService.mongoqueue.createQueue(data)\n}\n\nasync function monitorMongoQueue(mongoQueueService: any)\n{\n    console.log(\"run monitorMongoQueue\")\n        \n    //const mongoqueue = new MongoQueue(appConfig.mongoose).getMongoQueueService()\n    //check job is processing for each queue\n    const queueFilter = {\n      status:1\n    }\n    const queues = await mongoQueueService.getQueues(queueFilter)\n    console.log('queues', queues.length ?? 0)\n    for (let queue of queues)\n    {\n      //check processing job < consumers\n      const processJobFilter = {status:1, queue_code:queue.code}\n      const processJobs = await mongoQueueService.getJobs(processJobFilter)\n      console.log('queue: ',queue.code,':',queue.consumers,' - processJobs ', processJobs.length ?? 0)\n      if (processJobs.length < queue.consumers)\n      {\n        const readyJobFilter = {status:0, queue_code:queue.code}\n        const readyJobs = await mongoQueueService.getJobs(readyJobFilter)\n        console.log('queue: ',queue.code,' - readyJobs ', readyJobs.length ?? 0)\n        if (readyJobs.length > 0)\n        {\n          switch(queue.code)\n          {\n            case 'queue_sync_group_price_to_omni':\n                return ''\n            case 'queue_import_manage_group_code':\n               return ''\n          }\n        }          \n      }\n    }   \n        \n}\n\n"]}